<!doctype html>
if(o.thumb){ const im=document.createElement('img'); im.src=o.thumb; im.alt=o.title; thumb.appendChild(im);} else { thumb.innerHTML='<span style="font-size:11px;color:#8b93a7">Kein Bild</span>'; }
const title = document.createElement('div'); title.className='title'; title.textContent=o.title;
const price = document.createElement('div'); price.className='price'; price.textContent = (o.price||0)>0?('+'+money(o.price)):'+'+money(0);
card.appendChild(thumb); card.appendChild(title); card.appendChild(price);


card.addEventListener('click',()=>{
if(cat.type==='multi'){
if(state.extraSet.has(o.id)) state.extraSet.delete(o.id); else state.extraSet.add(o.id);
card.classList.toggle('active');
}else{
state.selections[cat.id]=o.id;
// deactivate siblings
[...opts.children].forEach(c=>c.classList.remove('active'));
card.classList.add('active');
}
refreshLayers(); updatePriceUI(); pushURLState(); updateMailto();
});


opts.appendChild(card);
});


root.appendChild(row);
});
}


function updateMailto(){
const lines = [];
lines.push('Meine Konfiguration:');
CONFIG.categories.forEach(cat=>{
if(cat.type==='multi'){
const chosen = (cat.options||[]).filter(o=>state.extraSet.has(o.id)).map(o=>o.title);
lines.push(`- ${cat.label}: ${chosen.length?chosen.join(', '):'keine'}`);
}else{
const sel = state.selections[cat.id];
const opt = (cat.options||[]).find(o=>o.id===sel);
lines.push(`- ${cat.label}: ${opt?opt.title:sel}`);
}
});
lines.push('');
lines.push('Link zur Konfiguration (öffnet den gleichen Stand):');
lines.push(location.href);
lines.push('');
lines.push('Bitte um Angebot mit Zeit & Gesamtpreis. Danke!');


const subject = encodeURIComponent('S51/S52 – Anfrage Konfiguration');
const body = encodeURIComponent(lines.join('\n'));
el('#mailtoBtn').href = `mailto:${CONFIG.email}?subject=${subject}&body=${body}`;
}


function resetAll(){
state.selections = {};
state.extraSet = new Set();
renderOptions();
if(CONFIG.preview.sequence && CONFIG.preview.sequence.length){ setup360(); }
else { refreshLayers(); }
updatePriceUI(); pushURLState(); updateMailto();
}


// ACTIONS
el('#copyLink').addEventListener('click',()=>{ pushURLState(); navigator.clipboard.writeText(location.href).then(()=>{
const b=el('#copyLink'); const old=b.textContent; b.textContent='Kopiert!'; setTimeout(()=>b.textContent=old,1200);
}); });
el('#resetBtn').addEventListener('click', resetAll);


// INIT
applyURLState();
renderOptions();
if(CONFIG.preview.sequence && CONFIG.preview.sequence.length){ setup360(); }
else { refreshLayers(); }
updatePriceUI();
pushURLState();
updateMailto();
</script>
</body>
</html>
